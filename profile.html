<link rel="stylesheet" href="style.css" />
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mon profil – MatchMates</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Police Google -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Ton CSS global -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="page-wrapper">
    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-mark">MM</div>
        <div class="logo-text">MatchMates</div>
      </div>

      <nav>
        <a href="index.html">Accueil</a>
        <a href="#mes-jeux">Mes jeux</a>
        <a href="#parametres">Paramètres</a>

        <div class="nav-cta">
          <span style="font-size: 13px; color: var(--text-muted);" id="nav-username">
            <!-- rempli en JS -->
          </span>
          <a class="btn btn-outline" href="/logout">Déconnexion</a>
        </div>
      </nav>
    </header>

    <!-- CONTENU PROFIL -->
    <main>
      <section style="margin-top: 40px;">
        <h1 class="section-title">Mon profil</h1>
        <p class="section-subtitle">
          Voici un aperçu de ton compte MatchMates. Bientôt tu pourras gérer ici tes jeux,
          ton niveau, tes rôles préférés, et plus encore.
        </p>

        <!-- Carte principale de profil -->
        <div class="hero-card" style="max-width: 520px; margin-top: 10px;">
          <div class="hero-card-header">
            <div>
              <div class="hero-card-title">Infos du compte</div>
              <div style="font-size: 11px; color: var(--text-muted);">
                Connecté en tant que <span id="profile-username"></span>
              </div>
            </div>
            <span class="hero-card-tag">Profil</span>
          </div>

          <div class="hero-list">
            <div class="hero-player">
              <div class="hero-player-left">
                <div class="hero-avatar" id="profile-avatar">U</div>
                <div class="hero-player-info">
                  <div class="hero-player-name" id="profile-username-main">Username</div>
                  <div class="hero-player-meta" id="profile-email">email@example.com</div>
                </div>
              </div>
              <div class="hero-player-role">
                Membre depuis
                <span id="profile-created">—</span>
              </div>
            </div>
          </div>

          <div class="hero-card-footer">
            <span>
              <span class="badge-online"></span>
              Session active
            </span>
            <span id="profile-id">ID #</span>
          </div>
        </div>

        <!-- Section placeholders -->
        <section id="mes-jeux" style="margin-top: 40px;">
          <h2 class="section-title">Mes jeux & rôles</h2>
          <p class="section-subtitle">
            Cette section pourra afficher les jeux auxquels tu joues, tes rôles favoris
            et ton niveau par jeu.
          </p>

          <div class="why-grid">
            <div class="why-card">
              <div class="why-title">Ajoute tes jeux</div>
              <div class="why-text">
                Plus tard, tu pourras lister ici les jeux auxquels tu joues et ton niveau
                pour améliorer les recommandations de coéquipiers.
              </div>
            </div>

            <div class="why-card">
              <div class="why-title">Définis ton style</div>
              <div class="why-text">
                Tryhard, chill, fun, compétitif… indique ton style pour matcher
                avec les bonnes personnes.
              </div>
            </div>

            <div class="why-card">
              <div class="why-title">Groupes & teams</div>
              <div class="why-text">
                Retrouve ici tes équipes fixes, groupes Discord, et futures features de
                matchmaking.
              </div>
            </div>
          </div>
        </section>

        <section id="parametres" style="margin-top: 40px;">
          <h2 class="section-title">Paramètres du compte</h2>
          <p class="section-subtitle">
            Plus tard : changer ton email, ton mot de passe, ton pseudo, gérer la sécurité
            et les notifications.
          </p>
        </section>
      </section>
    </main>

    <!-- FOOTER -->
    <footer>
      <div class="footer-links">
        <a href="#">À propos</a>
        <a href="#">Contact</a>
        <a href="#">Conditions d’utilisation</a>
        <a href="#">Confidentialité</a>
      </div>

      <div class="footer-socials">
        <div class="footer-pill">Rejoindre le Discord</div>
        <div class="footer-pill">Twitter</div>
        <div class="footer-pill">Instagram</div>
      </div>
    </footer>
  </div>

  <!-- Script pour récupérer les infos du joueur connecté -->
  <script>
    fetch("/api/me")
      .then((res) => {
        if (!res.ok) {
          // si la session n'est plus valide, on renvoie vers la page de login
          window.location.href = "/login.html";
          return null;
        }
        return res.json();
      })
      .then((data) => {
        if (!data) return;

        // Remplir les infos dans la page
        const username = data.username || "Utilisateur";
        const email = data.email || "—";

        document.getElementById("profile-username").textContent = username;
        document.getElementById("profile-username-main").textContent = username;
        document.getElementById("nav-username").textContent = username;
        document.getElementById("profile-email").textContent = email;
        document.getElementById("profile-id").textContent = "ID #" + data.id;

        // avatar = première lettre du pseudo
        document.getElementById("profile-avatar").textContent =
          username.charAt(0).toUpperCase();

        // date formatée
        if (data.created_at) {
          const d = new Date(data.created_at);
          const formatted = d.toLocaleDateString("fr-FR", {
            year: "numeric",
            month: "short",
            day: "2-digit",
          });
          document.getElementById("profile-created").textContent = formatted;
        }
      })
      .catch((err) => {
        console.error("Erreur /api/me :", err);
        window.location.href = "/login.html";
      });
  </script>
</body>
</html>

